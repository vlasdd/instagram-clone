"use strict";(self.webpackChunkinstagram_clone=self.webpackChunkinstagram_clone||[]).push([[703],{5910:function(e,t,s){var r=s(7762),n=s(5861),a=s(7757),c=s.n(a),l=s(83),u=s(9329),i=s(6724),o=s(4453),d=s(6871),f=s(1743);t.Z=function(){var e=(0,f.C)((function(e){return e.signedUser.user})),t=(0,d.s0)(),s=function(){var s=(0,n.Z)(c().mark((function s(r){var n,a,o,d,f,x;return c().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return n=r.chosenUserId,a=r.closeEvent,o=e.userId+"-"+n,d=n+"-"+e.userId,s.next=5,(0,i.PL)((0,i.hJ)(u.db,"chats"));case 5:if(f=s.sent,x="",f.forEach((function(e){var t=e.data().firstUserId+"-"+e.data().secondUserId;t!==o?t!==d||(x=d):x=o})),0===x.length){s.next=12;break}return a&&a(x),t(l.Z.DIRECT+"/"+x),s.abrupt("return");case 12:return s.next=14,(0,i.pl)((0,i.JU)(u.db,"chats",o),{firstUserId:e.userId,secondUserId:n,messages:[],lastMessage:{text:"",userId:""},lastEdited:(new Date).getTime()});case 14:a&&a(o),t(l.Z.DIRECT+"/"+o);case 16:case"end":return s.stop()}}),s)})));return function(e){return s.apply(this,arguments)}}(),a=function(){var e=(0,n.Z)(c().mark((function e(t){var s,n,a,l,d,f;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=t.messages,n=t.chatId,(0,i.oe)((0,i.JU)(u.db,"chats",n)),a=(0,r.Z)(s),e.prev=3,a.s();case 5:if((l=a.n()).done){e.next=13;break}if(!(d=l.value).media.length){e.next=11;break}return f=(0,o.iH)(u.tO,d.media),e.next=11,(0,o.oq)(f);case 11:e.next=5;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),a.e(e.t0);case 18:return e.prev=18,a.f(),e.finish(18);case 21:case"end":return e.stop()}}),e,null,[[3,15,18,21]])})));return function(t){return e.apply(this,arguments)}}();return{createChatRoom:s,deleteChatRoom:a}}},4965:function(e,t,s){var r=s(1413),n=s(5861),a=s(885),c=s(7757),l=s.n(c),u=s(9329),i=s(6724),o=s(2791),d={username:"",profileImage:"",userId:""};t.Z=function(e){var t=(0,o.useState)(d),s=(0,a.Z)(t,2),c=s[0],f=s[1];return(0,o.useEffect)((function(){var t=function(){var t=(0,n.Z)(l().mark((function t(){var s;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,i.QT)((0,i.JU)(u.db,"users",e));case 2:s=t.sent.data(),f((0,r.Z)({},s));case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();f(d),t()}),[e]),c}},522:function(e,t){t.Z=function(e){var t=new Date((new Date).getTime()-e),s=t.getMinutes(),r=Math.abs(Math.round(t.getTime()/1e3/3600)),n=r>24?(r/24).toFixed(0):0,a=n>7?(n/7).toFixed(0):0,c=n>30?(n/30).toFixed(0):0,l=c>12?(c/12).toFixed(0):0,u=l||c||a||n||r||s||(0===s?"Now":0);return u===l&&u.toString()+" year"||u===c&&u.toString()+" month"||u===a&&u.toString()+" week"||u===n&&u.toString()+" day"||u===r&&u.toString()+" hour"||u===s&&u.toString()+" minutes"||"Now"}},9703:function(e,t,s){s.r(t),s.d(t,{default:function(){return S}});var r=s(885),n=s(2791),a=s(6871),c=s(2982),l=s(5861),u=s(7757),i=s.n(u),o=s(213),d=s(1743),f=s(4874),x=s(417),m=s(5910),h=s(184),p=n.memo((function(e){var t=e.closeEvent,s=(0,d.C)((function(e){return e.signedUser.user})),a=(0,n.useState)(""),u=(0,r.Z)(a,2),p=u[0],g=u[1],v=(0,n.useState)([]),j=(0,r.Z)(v,2),w=j[0],b=j[1],I=(0,n.useState)([]),N=(0,r.Z)(I,2),k=N[0],y=N[1],U=(0,m.Z)().createChatRoom,Z=(0,n.useRef)(null);(0,n.useEffect)((function(){var e=setTimeout((0,l.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.Z)(p,y);case 2:y((function(e){return e.filter((function(e){return e.username!==s.username}))}));case 3:case"end":return e.stop()}}),e)}))),300);return function(){return clearTimeout(e)}}),[p]);var C=(0,n.useCallback)((function(e){b((function(t){return t.filter((function(t){return t.username!==e.username}))})),null!==Z.current&&Z.current.focus()}),[Z.current]),E=(0,n.useMemo)((function(){return w.map((function(e){return(0,h.jsx)("div",{className:"bg-blue-100 flex rounded p-2",children:(0,h.jsxs)("button",{className:"flex gap-1",onClick:function(){return C(e)},children:[(0,h.jsx)("p",{className:"text-cyan-500 text-sm ",children:e.username}),(0,h.jsx)(f.Z,{styles:"w-5 h-5 text-cyan-500"})]})},e.userId)}))}),[w,Z]),M=(0,n.useMemo)((function(){return k.map((function(e){return(0,h.jsx)(x.Z,{addUserToList:function(){return function(e){b((function(t){return[].concat((0,c.Z)(t),[e])})),g(""),null!==Z.current&&Z.current.focus()}(e)},removeUserFromList:function(){return function(e){b((function(t){return t.filter((function(t){return t.username!==e.username}))})),null!==Z.current&&Z.current.focus()}(e)},isUserInList:w.some((function(t){return t.username===e.username})),profileImage:e.profileImage,username:e.username,fullName:e.fullName,userId:e.userId},e.userId)}))}),[k,w]),S=(0,n.useCallback)((function(){U({chosenUserId:w[0].userId,closeEvent:t})}),[w]),T=(0,n.useCallback)((function(e){g(e.target.value)}),[]);return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("div",{className:"h-11 w-full flex justify-center items-center font-medium border-b relative ",children:[(0,h.jsx)("button",{className:"absolute left-2",onClick:t,children:(0,h.jsx)(f.Z,{styles:"w-7 h-7"})}),(0,h.jsx)("p",{children:"New message"}),(0,h.jsx)("button",{className:"absolute right-3 font-bold ".concat(0===w.length?"text-blue-300":"text-blue-500"),disabled:0===w.length,onClick:S,children:(0,h.jsx)("p",{children:"Next"})})]}),(0,h.jsxs)("div",{className:"w-full max-h-[175px] flex border-b p-3 items-start gap-5",children:[(0,h.jsx)("p",{className:"font-medium mt-[6px]",children:"To:"}),(0,h.jsxs)("div",{className:"w-full h-full flex flex-col items-start gap-2 overflow-hidden overflow-y-auto",children:[E,(0,h.jsx)("input",{className:"w-full p-2 rounded-lg placeholder:font-light placeholder:text-gray-400 placeholder:text-sm relative text-sm",type:"text",placeholder:"Search...",value:p,onChange:T,ref:Z})]})]}),(0,h.jsx)("div",{className:"flex flex-col overflow-hidden overflow-y-auto",children:k.length?M:(0,h.jsx)("p",{className:"font-medium text-sm pl-3 mt-2",children:"No Suggested"})})]})})),g=n.memo((function(e){var t=e.openModal;return(0,h.jsxs)("div",{className:"w-full h-full flex flex-col justify-center items-center gap-1",children:[(0,h.jsx)("img",{src:"/instagram-clone/images/direct.jpg",className:"w-[120px] h-[112px]",alt:"direct"}),(0,h.jsx)("p",{className:"text-2xl font-thin",children:"Your Messages"}),(0,h.jsx)("p",{className:"text-gray-400 text-sm",children:"Send private photos and messages to a friend or group."}),(0,h.jsx)("button",{className:"h-[30px] w-[115px] mt-5 bg-blue-500 font-medium text-white rounded cursor-pointer text-sm tracking-wide flex items-center justify-center",onClick:t,children:"Send Message"})]})})),v=s(83),j=function(){return(0,h.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-[26px] w-[26px] text-gray-800",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:(0,h.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})},w=s(522),b=s(4965),I=n.memo((function(e){var t=e.userId,s=e.chatId,r=e.lastMessage,c=e.lastEdited,l=(0,a.s0)(),u=(0,a.UO)().chatId,i=(0,b.Z)(t),o=(0,n.useCallback)((function(){var e=(0,w.Z)(c);return"Now"===e?e:e.split(" ")[0]+e.split(" ")[1][0]}),[c]),d=(0,n.useCallback)((function(){l(v.Z.DIRECT+"/"+s)}),[s]);return(0,h.jsx)("button",{className:"flex h-20 px-2 pr-6 items-center justify-center py-1 ".concat(u===s&&"back"),onClick:d,children:(0,h.jsxs)("div",{className:"w-full h-16 py-[0.5px] gap-4 flex items-center px-3",children:[(0,h.jsx)("img",{src:i.profileImage.length?i.profileImage:"/instagram-clone/images/default-avatar-gray.jpg",className:"h-[60px] w-[60px] rounded-full object-cover"}),(0,h.jsxs)("div",{className:"flex flex-col justify-center text-left w-full",children:[(0,h.jsx)("p",{className:"w-[165px] truncate text-sm tracking-wide",children:i.username}),(0,h.jsxs)("div",{className:"flex gap-1",children:[(0,h.jsx)("p",{className:"font-medium text-sm tracking-wide whitespace-nowrap",children:"".concat(r.userId!==t&&r.text.length?"You:":" ")}),(0,h.jsx)("p",{className:"max-w-[125px] truncate text-gray-400 text-sm",children:r.text}),0!==r.userId.length?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("p",{className:"text-sm text-gray-400",children:"\u2022"}),(0,h.jsx)("p",{className:"text-sm text-gray-400",children:o()})]}):null]})]})]})})})),N=s(9688),k=s(9329),y=s(6724),U=function(e){var t=(0,d.C)((function(e){return e.signedUser.user})),s=(0,n.useState)([]),a=(0,r.Z)(s,2),c=a[0],u=a[1];return(0,n.useEffect)((function(){var e=function(){var e=(0,l.Z)(i().mark((function e(){var s,r,n,a,c,l,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(0,y.hJ)(k.db,"chats"),r=(0,y.IO)(s,(0,y.ar)("firstUserId","==",t.userId)),n=(0,y.IO)(s,(0,y.ar)("secondUserId","==",t.userId)),e.next=5,(0,y.PL)(r);case 5:return a=e.sent,e.next=8,(0,y.PL)(n);case 8:c=e.sent,l=a.docs.map((function(e){return e.data()})).concat(c.docs.map((function(e){return e.data()}))),o=l.map((function(e){return{firstUserId:e.firstUserId,secondUserId:e.secondUserId,messages:e.messsages,lastMessage:e.lastMessage,lastEdited:e.lastEdited}})),u(o.sort((function(e,t){return t.lastEdited-e.lastEdited})));case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.cf)((0,y.IO)((0,y.hJ)(k.db,"chats"),(0,y.ar)("firstUserId","==",t.userId)),(0,l.Z)(i().mark((function t(){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e();case 2:case"end":return t.stop()}}),t)})))),(0,y.cf)((0,y.IO)((0,y.hJ)(k.db,"chats"),(0,y.ar)("secondUserId","==",t.userId)),(0,l.Z)(i().mark((function t(){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e();case 2:case"end":return t.stop()}}),t)}))))}),[t.userId,e]),c},Z=n.memo((function(e){var t=e.openModal,s=(0,d.C)((function(e){return e.signedUser.user})),r=(0,a.s0)(),c=(0,a.UO)().chatId,l=U(c),u=(0,n.useCallback)((function(){for(var e=[],t=0;t<3;t++)e.push((0,h.jsx)(N.Z,{imageStyles:{width:60,height:60,borderRadius:"50%"},firstTextStyles:{width:180,height:11,borderRadius:"10px"},secondTextStyles:{width:150,height:11,borderRadius:"10px"},margin:"my-1"},t));return e}),[]),i=(0,n.useMemo)((function(){return l.map((function(e){return(0,h.jsx)(I,{chatId:e.firstUserId+"-"+e.secondUserId,userId:s.userId===e.firstUserId?e.secondUserId:e.firstUserId,lastMessage:e.lastMessage,lastEdited:e.lastEdited},s.userId===e.firstUserId?e.secondUserId:e.firstUserId)}))}),[l,s.userId]),o=(0,n.useCallback)((function(){r(v.Z.DIRECT)}),[]);return(0,h.jsxs)("aside",{className:"w-full sm:w-[520px] h-full border-r flex flex-col",children:[(0,h.jsxs)("div",{className:"flex justify-end items-center h-[60px] border-b pr-4",children:[(0,h.jsx)("div",{className:"w-full flex justify-center pl-4",children:(0,h.jsx)("button",{className:"font-medium",onClick:o,children:(0,h.jsxs)("p",{children:["@",s.username]})})}),(0,h.jsx)("button",{onClick:t,children:(0,h.jsx)(j,{})})]}),(0,h.jsx)("nav",{className:"flex flex-col w-full h-[calc(100%-60px)] overflow-hidden overflow-y-auto",children:l.length?i:u()})]})})),C=s(3073),E=s(1273),M=s(7018),S=n.memo((function(){var e=(0,a.UO)().chatId,t=(0,n.useState)(!1),s=(0,r.Z)(t,2),c=s[0],l=s[1],u=(0,M.Z)(),i=(0,n.useCallback)((function(){l(!0)}),[]),o=(0,n.useCallback)((function(){l(!1)}),[]);return(0,h.jsxs)("div",{className:"back w-screen h-screen flex flex-col items-center ",children:[(0,h.jsx)(C.Z,{}),(0,h.jsxs)("section",{className:"flex flex-col sm:flex-row gap-16 sm:gap-0 bg-white w-full md:w-11/12 lg:w-4/5 xl:w-2/3 h-[calc(100vh-90px)] max-w-[935px] border-x border-b border-t my-3",children:[u>640?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(Z,{openModal:i}),e?(0,h.jsx)(a.j3,{}):(0,h.jsx)(g,{openModal:i})]}):e?(0,h.jsx)(a.j3,{}):(0,h.jsx)(Z,{openModal:i}),c?(0,h.jsx)(E.Z,{closeEvent:o,styles:"h-[450px] top-[20%]",children:(0,h.jsx)(p,{closeEvent:o})}):null]})]})}))},417:function(e,t,s){var r=s(2791),n=s(184),a=r.memo((function(e){var t=e.profileImage,s=e.username,r=e.fullName,a=e.addUserToList,c=e.removeUserFromList,l=e.isUserInList;return(0,n.jsxs)("button",{className:"flex h-13 mb-1 px-2 pr-6 items-center justify-center py-1",onClick:l?c:a,children:[(0,n.jsxs)("div",{className:"w-full h-full py-[0.5px] gap-2 flex items-center",children:[(0,n.jsx)("img",{src:t.length?t:"/instagram-clone/images/default-avatar-image.jpg",className:"h-12 w-12 rounded-full object-cover"}),(0,n.jsxs)("div",{className:"flex flex-col justify-center text-left",children:[(0,n.jsx)("p",{className:"font-medium text-sm tracking-[0.3px] whitespace-nowrap",children:s}),(0,n.jsx)("p",{className:"text-gray-400 text-sm tracking-[0px] whitespace-nowrap",children:r})]})]}),l?(0,n.jsxs)("div",{className:"w-6 h-6 rounded-full bg-blue-500",children:[(0,n.jsx)("div",{className:"h-[2px] w-[7px] bg-white mt-3 ml-1 rotate-[45deg]"}),(0,n.jsx)("div",{className:"h-[2px] w-3 bg-white mt-[-3px] ml-2 rotate-[-45deg]"})]}):(0,n.jsx)("div",{className:"w-6 h-6 rounded-full border-2 border-black"})]})}));t.Z=a}}]);
//# sourceMappingURL=703.a87b9b6c.chunk.js.map